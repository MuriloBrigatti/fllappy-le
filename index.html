<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Flappy Le</title>
<style>
  * { -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
  body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(to bottom, #ffe4ec, #ffd6e8);
    font-family: 'Poppins', sans-serif;
    touch-action: none;
  }
  #game-area {
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
  }
  #character {
    position: absolute;
    left: 80px;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background-color: #FFC0CB;
    border: 3px solid #FF69B4;
    background-size: cover;
    background-position: center;
    will-change: top, transform;
  }
  .pipe {
    position: absolute;
    width: 60px;
    background-color: #ff8acb;
    border: 2px solid #ff69b4;
    right: 0;
  }
  #overlay {
    position: absolute;
    width: 100%;
    height: 100%;
    background: rgba(255,255,255,0.92);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    transition: opacity 0.4s;
  }
  h1 {
    color: #ff69b4;
    font-size: 2.5em;
    margin: 0 0 10px;
  }
  #score-text, #high-score-text {
    color: #ff69b4;
    font-size: 1.1em;
    margin: 4px 0;
  }
  #start-button, #upload-button {
    background-color: #ff69b4;
    color: white;
    border: none;
    padding: 12px 26px;
    border-radius: 12px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 14px;
    transition: transform 0.15s;
  }
  #start-button:active, #upload-button:active {
    transform: scale(0.97);
  }
  #score-display {
    position: absolute;
    top: 12px;
    left: 14px;
    font-size: 1.8em;
    font-weight: bold;
    color: #ff69b4;
    z-index: 10;
  }
  #photo-picker {
    margin-top: 15px;
    text-align: center;
  }
  #image-status {
    font-size: 13px;
    color: #ff69b4;
    margin-top: 8px;
  }
  input[type=file] {
    display: none;
  }
</style>
</head>
<body>
  <div id="game-area">
    <div id="character"></div>
    <div id="score-display">0</div>
    <div id="overlay">
      <h1>Flappy Le</h1>
      <p id="score-text"></p>
      <p id="high-score-text"></p>
      <button id="start-button">ComeÃ§ar</button>
      <div id="photo-picker">
        <button id="upload-button">ðŸ“¸ Adicionar Foto</button>
        <input type="file" id="image-upload" accept="image/*;capture=camera">
        <p id="image-status">Usando personagem padrÃ£o.</p>
      </div>
    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const gameArea = document.getElementById("game-area");
  const character = document.getElementById("character");
  const overlay = document.getElementById("overlay");
  const startButton = document.getElementById("start-button");
  const scoreDisplay = document.getElementById("score-display");
  const scoreText = document.getElementById("score-text");
  const highScoreText = document.getElementById("high-score-text");
  const uploadButton = document.getElementById("upload-button");
  const imageUpload = document.getElementById("image-upload");
  const imageStatus = document.getElementById("image-status");

  let velocity = 0, gravity = 0.45, jump = -8.5;
  let characterTop = gameArea.clientHeight / 2;
  let isGameOver = true;
  let score = 0;
  let highScore = localStorage.getItem("flappyLeHighScore") || 0;
  let gameLoop, pipeTimer;
  const charSize = 48;

  // Carrega imagem salva
  const savedImg = localStorage.getItem("flappyLeImage");
  if (savedImg) {
    character.style.backgroundImage = `url(${savedImg})`;
    character.style.border = "none";
    character.style.backgroundColor = "transparent";
    imageStatus.textContent = "Usando sua foto! ðŸ’–";
  }

  // Upload compatÃ­vel com celular
  uploadButton.addEventListener("click", () => {
    imageUpload.value = "";
    imageUpload.click();
  });

  imageUpload.addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
      character.style.backgroundImage = `url(${ev.target.result})`;
      character.style.border = "none";
      character.style.backgroundColor = "transparent";
      localStorage.setItem("flappyLeImage", ev.target.result);
      imageStatus.textContent = "Usando sua foto! ðŸ’–";
    };
    reader.readAsDataURL(file);
  });

  // FunÃ§Ãµes principais
  function resetGame() {
    document.querySelectorAll(".pipe").forEach(p => p.remove());
    score = 0;
    velocity = 0;
    characterTop = gameArea.clientHeight / 2;
    isGameOver = false;
    overlay.style.opacity = "0";
    overlay.style.pointerEvents = "none";
    startButton.style.display = "none";
    scoreDisplay.textContent = "0";
    startGameLoop();
  }

  function endGame() {
    isGameOver = true;
    cancelAnimationFrame(gameLoop);
    clearInterval(pipeTimer);
    if (score > highScore) {
      highScore = score;
      localStorage.setItem("flappyLeHighScore", highScore);
    }
    overlay.style.opacity = "1";
    overlay.style.pointerEvents = "auto";
    scoreText.textContent = `PontuaÃ§Ã£o: ${score}`;
    highScoreText.textContent = `Recorde: ${highScore}`;
    startButton.style.display = "block";
  }

  function jumpAction() {
    if (isGameOver) resetGame();
    else velocity = jump;
  }

  function createPipe() {
    const gap = 165;
    const topHeight = Math.random() * (gameArea.clientHeight - gap - 100) + 40;
    const bottomHeight = gameArea.clientHeight - topHeight - gap;
    const top = document.createElement("div");
    const bottom = document.createElement("div");
    top.className = "pipe";
    bottom.className = "pipe";
    top.style.top = "0";
    bottom.style.bottom = "0";
    top.style.height = `${topHeight}px`;
    bottom.style.height = `${bottomHeight}px`;
    gameArea.append(top, bottom);

    let x = gameArea.clientWidth;
    const move = () => {
      if (isGameOver) return top.remove(), bottom.remove();
      x -= 3;
      top.style.right = bottom.style.right = `${gameArea.clientWidth - x}px`;
      const charRect = character.getBoundingClientRect();
      const topRect = top.getBoundingClientRect();
      const botRect = bottom.getBoundingClientRect();

      if (
        charRect.left < topRect.right &&
        charRect.right > topRect.left &&
        (charRect.top < topRect.bottom || charRect.bottom > botRect.top)
      ) return endGame();

      if (!top.passed && topRect.right < charRect.left) {
        score++;
        scoreDisplay.textContent = score;
        top.passed = true;
      }
      if (x > -60) requestAnimationFrame(move);
      else top.remove(), bottom.remove();
    };
    move();
  }

  function startGameLoop() {
    function loop() {
      if (isGameOver) return;
      velocity += gravity;
      characterTop += velocity;
      if (characterTop + charSize >= gameArea.clientHeight || characterTop <= 0) return endGame();
      character.style.top = `${characterTop}px`;
      gameLoop = requestAnimationFrame(loop);
    }
    gameLoop = requestAnimationFrame(loop);
    pipeTimer = setInterval(createPipe, 1600);
  }

  document.addEventListener("touchstart", e => { e.preventDefault(); jumpAction(); }, { passive: false });
  document.addEventListener("click", jumpAction);
  document.addEventListener("keydown", e => { if (e.code === "Space") jumpAction(); });
  startButton.addEventListener("click", resetGame);
});
</script>
</body>
</html>
